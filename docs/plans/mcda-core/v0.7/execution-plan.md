# MCDA Core v0.7 执行计划

**版本**: v0.7
**创建日期**: 2026-02-04
**状态**: 📋 规划完成，待批准
**预计工期**: 11 人日 (2.5 周)
**优先级**: P1 (高)

---

## 📊 版本总览

### 目标

聚焦**核心算法区间扩展** + **可能度排序**,建立区间MCDA坚实基础

### 核心价值

- ✅ 补全 VIKOR 区间版本（v0.5 遗留）
- ✅ 实现可能度排序（比中点法更精确）
- ✅ TODIM 区间版本（前景理论价值）
- ✅ 风险可控，工期合理

### 版本范围

| 功能 | 优先级 | 工期 | 依赖 |
|------|--------|------|------|
| Phase 0: 技术验证 | P0 | 2人日 | - |
| Phase 1: VIKOR 区间版本 | P0 | 3人日 | Phase 0 |
| Phase 2: 可能度排序 | P1 | 4人日 | Phase 0 |
| Phase 3: TODIM 区间版本 | P2 | 4人日 | Phase 2 |
| Phase 4: 集成与文档 | P1 | 2人日 | Phase 1-3 |

**总工期**: 11 人日

---

## 🎯 功能详细规划

### Phase 0: 技术验证 (2 人日)

**目标**: 验证关键技术可行性，降低实施风险

#### 任务清单

| 任务ID | 任务名称 | 工期 | 交付物 | 状态 |
|--------|---------|------|--------|------|
| P0-T1 | VIKOR 区间可行性验证 | 0.5人日 | 验证报告 | ⏳ |
| P0-T2 | 可能度排序原型开发 | 0.8人日 | 原型代码 | ⏳ |
| P0-T3 | ELECTRE-I 区间学术调研 | 0.5人日 | 调研报告 | ⏳ |
| P0-T4 | TODIM 区间算法设计 | 0.2人日 | 设计文档 | ⏳ |

#### 验证标准

**VIKOR 区间可行性**:
- [ ] 区间群体效用 S 计算方法明确
- [ ] 区间个别遗憾 R 计算方法明确
- [ ] 区间折衷值 Q 计算方法明确
- [ ] 排序策略确定（中点法 or 可能度法）
- [ ] 性能预期: < 0.5 秒

**可能度排序原型**:
- [ ] P(A ≥ B) 计算公式验证
- [ ] 综合可能度排序算法实现
- [ ] 边界条件测试（重合区间、包含区间）
- [ ] 性能预期: 10 个区间 < 0.1 秒

**ELECTRE-I 区间调研**:
- [ ] 查找 2+ 篇区间 ELECTRE-I 论文
- [ ] 区间和谐指数计算方法
- [ ] 区间不和谐指数计算方法
- [ ] 区间核提取算法
- [ ] 技术风险评估

**成功标准**:
- ✅ VIKOR 区间可行性验证通过
- ✅ 可能度排序原型工作正常
- ✅ ELECTRE-I 区间有充分学术支持 OR 决定延迟到 v0.9

**失败应急**:
- 如果 VIKOR 区间验证失败 → 调整为只实现可能度排序 + TODIM 区间版本
- 如果可能度排序原型失败 → 使用中点法,可能度延迟到 v0.8
- 如果 ELECTRE-I 区间学术支持不足 → 正式决定延迟到 v0.9

---

### Phase 1: VIKOR 区间版本 (3 人日)

**目标**: 实现 VIKOR 算法的区间版本

#### 数学模型

**步骤1**: 标准化区间决策矩阵
```
r_ij = x_ij / sqrt(Σ (x_ij)^2)
```

**步骤2**: 计算区间群体效用 S
```
S_i = [S_i^L, S_i^U] = Σ w_j · (x_j^max - x_ij) / (x_j^max - x_j^min)
```

**步骤3**: 计算区间个别遗憾 R
```
R_i = [R_i^L, R_i^U] = max_j [w_j · (x_j^max - x_ij) / (x_j^max - x_j^min)]
```

**步骤4**: 计算区间折衷值 Q
```
Q_i = [Q_i^L, Q_i^U]
     = v · (S_i - S_min) / (S_max - S_min)
     + (1-v) · (R_i - R_min) / (R_max - R_min)
```

**步骤5**: 排序
- 优先级1: Q_i 最小（折衷解）
- 优先级2: S_i 最小（群体效用）
- 优先级3: R_i 最小（个别遗憾）

使用**可能度排序**（Phase 2 实现）

#### 任务清单

| 任务ID | 任务名称 | 工期 | 交付物 | 测试数 | 状态 |
|--------|---------|------|--------|--------|------|
| P1-T1 | IntervalVIKOR 类实现 | 1.0人日 | 代码 | - | ⏳ |
| P1-T2 | 区间标准化方法 | 0.5人日 | 代码 | 6 | ⏳ |
| P1-T3 | 区间群体效用 S 计算 | 0.5人日 | 代码 | 8 | ⏳ |
| P1-T4 | 区间个别遗憾 R 计算 | 0.5人日 | 代码 | 8 | ⏳ |
| P1-T5 | 区间折衷值 Q 计算 | 0.5人日 | 代码 | 8 | ⏳ |
| P1-T6 | 排序与折衷解判定 | 1.0人日 | 代码 | 8 | ⏳ |

**总测试数**: 38 个

#### 验收标准

**功能完整性**:
- [ ] 区间 VIKOR 算法完整实现
- [ ] 支持可调决策策略系数 v (0-1)
- [ ] 折衷解判定逻辑正确
- [ ] 与精确数 VIKOR 结果兼容（当区间退化为点）

**质量指标**:
- [ ] 测试覆盖率 >= 85%
- [ ] 测试通过率 100%
- [ ] 执行时间 < 0.5 秒

**文档要求**:
- [ ] API 文档完整
- [ ] 数学模型说明
- [ ] 使用示例

---

### Phase 2: 可能度排序 (4 人日)

**目标**: 实现基于可能度的区间排序方法

#### 数学模型

**可能度定义**: P(A ≥ B) 表示区间 A 大于等于区间 B 的可能度

**计算公式**:
```
P(A ≥ B) = {
    1,                              if A^L ≥ B^U
    0,                              if A^U ≤ B^L
    (A^U - B^L) / ((A^U - A^L) + (B^U - B^L)),  otherwise
}
```

**性质**:
- P(A ≥ B) + P(B ≥ A) = 1
- P(A ≥ B) = 1 当且仅当 A ≥ B
- P(A ≥ B) = 0.5 当且仅当 A = B

**排序方法**:
```
对于多个区间 {A1, A2, ..., An}:
1. 计算两两可能度矩阵 P = [P(Ai ≥ Aj)]
2. 计算综合可能度: Si = Σ P(Ai ≥ Aj)
3. 按 Si 排序（越大越好）
```

#### 任务清单

| 任务ID | 任务名称 | 工期 | 交付物 | 测试数 | 状态 |
|--------|---------|------|--------|--------|------|
| P2-T1 | PossibilityDegree 类实现 | 1.0人日 | 代码 | 8 | ⏳ |
| P2-T2 | P(A ≥ B) 计算方法 | 1.0人日 | 代码 | 8 | ⏳ |
| P2-T3 | 综合可能度排序 | 1.0人日 | 代码 | 8 | ⏳ |
| P2-T4 | 集成到 VIKOR | 0.5人日 | 代码 | 4 | ⏳ |
| P2-T5 | 集成到 TODIM (Phase 3) | 0.5人日 | 代码 | 4 | ⏳ |

**总测试数**: 32 个

#### 验收标准

**功能完整性**:
- [ ] P(A ≥ B) 计算正确
- [ ] 综合可能度排序算法实现
- [ ] 边界条件处理（重合区间、包含区间、退化区间）
- [ ] 集成到 VIKOR 和 TODIM

**质量指标**:
- [ ] 测试覆盖率 >= 90%
- [ ] 测试通过率 100%
- [ ] 排序性能: 10 个区间 < 0.1 秒

**对比验证**:
- [ ] 与中点法排序对比
- [ ] 验证可能度法的优势（保留区间信息）

---

### Phase 3: TODIM 区间版本 (4 人日)

**目标**: 实现 TODIM 算法的区间版本

#### 数学模型

**前景理论价值函数**:
```
v(x) = {
    x^α,                   if x ≥ 0  (收益)
    -θ · (-x)^β,           if x < 0  (损失)
}
```

其中:
- α, β: 风险态度参数 (通常 α = β = 0.88)
- θ: 损失厌恶系数 (通常 θ = 2.25)

**区间优势度计算**:
```
Φ_i(A_j) = Σ (w_j / w_ref) · v(d_ij)
```

其中:
- d_ij: 方案 i 在准则 j 下的区间收益/损失
- v(d_ij): 前景价值函数（区间版本）

**全局优势度**:
```
δ_i = Σ Φ_i(A_j)
```

**排序**: 按 δ_i 降序排列

#### 任务清单

| 任务ID | 任务名称 | 工期 | 交付物 | 测试数 | 状态 |
|--------|---------|------|--------|--------|------|
| P3-T1 | IntervalTODIM 类实现 | 1.0人日 | 代码 | - | ⏳ |
| P3-T2 | 区间前景价值函数 | 1.0人日 | 代码 | 8 | ⏳ |
| P3-T3 | 区间优势度计算 | 1.0人日 | 代码 | 8 | ⏳ |
| P3-T4 | 区间全局优势度 | 0.5人日 | 代码 | 8 | ⏳ |
| P3-T5 | 可能度排序集成 | 0.5人日 | 代码 | 4 | ⏳ |

**总测试数**: 28 个

#### 验收标准

**功能完整性**:
- [ ] 区间 TODIM 算法完整实现
- [ ] 支持前景理论参数调整（α, β, θ）
- [ ] 区间收益/损失计算正确
- [ ] 使用可能度排序

**质量指标**:
- [ ] 测试覆盖率 >= 85%
- [ ] 测试通过率 100%
- [ ] 执行时间 < 0.5 秒

**对比验证**:
- [ ] 与精确数 TODIM 结果兼容（当区间退化为点）
- [ ] 验证前景理论在区间数下的有效性

---

### Phase 4: 集成与文档 (2 人日)

**目标**: 确保版本质量，完善文档

#### 任务清单

| 任务ID | 任务名称 | 工期 | 交付物 | 测试数 | 状态 |
|--------|---------|------|--------|--------|------|
| P4-T1 | 集成测试 | 0.5人日 | 测试代码 | 10 | ⏳ |
| P4-T2 | 性能测试 | 0.3人日 | 测试报告 | - | ⏳ |
| P4-T3 | API 文档更新 | 0.5人日 | 文档 | - | ⏳ |
| P4-T4 | 使用示例 | 0.3人日 | 示例代码 | - | ⏳ |
| P4-T5 | README 更新 | 0.2人日 | 文档 | - | ⏳ |
| P4-T6 | 发布说明 | 0.2人日 | 文档 | - | ⏳ |

**总测试数**: 10 个集成测试

#### 验收标准

**集成测试**:
- [ ] VIKOR + 可能度排序集成测试
- [ ] TODIM + 可能度排序集成测试
- [ ] 多算法对比测试
- [ ] 边界条件集成测试

**性能测试**:
- [ ] 10 个方案 × 10 个准则: < 1 秒
- [ ] 50 个方案 × 20 个准则: < 5 秒
- [ ] 区间运算 vs 精确数运算性能对比

**文档完整性**:
- [ ] API 文档完整（所有新类和方法）
- [ ] 数学模型说明（可能度排序）
- [ ] 使用示例（VIKOR 区间、TODIM 区间）
- [ ] 更新 README_CN.md
- [ ] 发布说明（CHANGELOG.md）

---

## 📊 测试策略

### 测试覆盖率目标

| 模块 | 目标覆盖率 | 测试数 |
|------|-----------|--------|
| VIKOR 区间版本 | >= 85% | 38 |
| 可能度排序 | >= 90% | 32 |
| TODIM 区间版本 | >= 85% | 28 |
| 集成测试 | >= 80% | 10 |
| **总计** | **>= 85%** | **108** |

### 测试类型分布

| 测试类型 | 数量 | 占比 |
|---------|------|------|
| 基础功能测试 | 40 | 37% |
| 详细功能测试 | 30 | 28% |
| 边界条件测试 | 20 | 19% |
| 错误处理测试 | 10 | 9% |
| 集成测试 | 10 | 9% |
| **总计** | **108** | **100%** |

### 测试数据

**VIKOR 区间版本测试数据**:
- 示例1: 云服务商选择（3 方案 × 4 准则）
- 示例2: 供应商评估（5 方案 × 6 准则）
- 边界条件: 退化区间、重合区间

**TODIM 区间版本测试数据**:
- 示例1: 投资项目选择（4 方案 × 5 准则）
- 示例2: 风险评估（6 方案 × 4 准则）
- 边界条件: 前景理论参数变化

**可能度排序测试数据**:
- 2 个区间比较
- 10 个区间排序
- 边界条件: 重合、包含、退化

---

## 🔧 技术实现要点

### 代码组织

```
skills/mcda-core/lib/
├── algorithms/
│   ├── vikor_interval.py       # VIKOR 区间版本
│   └── todim_interval.py       # TODIM 区间版本
├── interval.py                 # 区间数类型（已存在）
├── ranking/                    # 新增: 排序模块
│   ├── __init__.py
│   └── possibility_degree.py   # 可能度排序
└── utils/
    └── interval_utils.py       # 区间工具函数
```

### 关键设计决策

**1. 区间运算策略**:
- 使用 `Interval` 类（v0.5 已实现）
- 所有区间运算返回 `Interval` 对象
- 保持不可变性（frozen dataclass）

**2. 排序接口设计**:
```python
class RankingStrategy(ABC):
    """排序策略接口"""

    @abstractmethod
    def rank_intervals(
        self,
        intervals: dict[str, Interval],
        scores: dict[str, float]
    ) -> list[tuple[str, float]]:
        """对区间排序"""
        pass
```

**实现**:
- `MidpointRanking`: 中点法排序（v0.5 已实现）
- `PossibilityDegreeRanking`: 可能度排序（v0.7 新增）

**3. 算法注册**:
```python
@register_algorithm("vikor_interval")
class VIKORIntervalAlgorithm(MCDAAlgorithm):
    """VIKOR 区间版本"""
    pass

@register_algorithm("todim_interval")
class TODIMIntervalAlgorithm(MCDAAlgorithm):
    """TODIM 区间版本"""
    pass
```

---

## 📈 质量保证

### 代码质量标准

| 指标 | 目标 | 验证方法 |
|------|------|---------|
| 类型注解 | 100% | mypy 检查 |
| 文档字符串 | 100% | 代码审查 |
| PEP 8 合规 | 100% | pylint/flake8 |
| 测试覆盖率 | >= 85% | pytest-cov |
| 测试通过率 | 100% | pytest |
| 代码复杂度 | <= 15 | pylint |

### 代码审查清单

**算法实现**:
- [ ] 数学模型正确性
- [ ] 边界条件处理
- [ ] 错误处理完整性
- [ ] 性能考虑

**代码质量**:
- [ ] 命名清晰（中文注释）
- [ ] 逻辑简洁
- [ ] 避免重复代码
- [ ] 适当使用工具函数

**测试质量**:
- [ ] 测试覆盖率达标
- [ ] 测试用例完整性
- [ ] 边界条件测试
- [ ] 错误处理测试

---

## 🚀 实施计划

### 时间线

```
Week 1: Phase 0 + Phase 1 开始
├─ Day 1-2: Phase 0 技术验证
├─ Day 3-5: Phase 1.1-1.3 (VIKOR 区间版本 - 基础实现)
└─ 验收点: Phase 0 通过, Phase 1 进度 50%

Week 2: Phase 1 完成 + Phase 2
├─ Day 6-7: Phase 1.4-1.6 (VIKOR 区间版本 - 完成)
├─ Day 8-10: Phase 2.1-2.3 (可能度排序 - 基础实现)
└─ 验收点: Phase 1 完成, Phase 2 进度 75%

Week 2.5: Phase 2-3
├─ Day 11: Phase 2.4-2.5 (可能度排序 - 集成)
├─ Day 12-13: Phase 3.1-3.3 (TODIM 区间版本)
└─ 验收点: Phase 2 完成, Phase 3 进度 75%

Week 3: Phase 3-4
├─ Day 14: Phase 3.4-3.5 (TODIM 区间版本 - 完成)
├─ Day 15: Phase 4 (集成与文档)
└─ 最终验收: 所有 Phase 完成, 质量达标
```

### 里程碑

| 里程碑 | 日期 | 交付物 | 验收标准 |
|--------|------|--------|---------|
| M1: Phase 0 完成 | Day 2 | 验证报告 | 技术可行性确认 |
| M2: Phase 1 完成 | Day 7 | VIKOR 区间版本 | 38 个测试通过 |
| M3: Phase 2 完成 | Day 11 | 可能度排序 | 32 个测试通过 |
| M4: Phase 3 完成 | Day 14 | TODIM 区间版本 | 28 个测试通过 |
| M5: v0.7 发布 | Day 15 | 完整版本 | 108 个测试通过, 文档完整 |

### 风险管理

| 风险 | 影响 | 概率 | 缓解措施 | 应急计划 |
|------|------|------|---------|---------|
| Phase 0 验证失败 | 高 | 中 | 充分验证,预留缓冲 | 调整功能范围 |
| 可能度排序性能问题 | 中 | 低 | 算法优化,向量化 | 降级到中点法 |
| TODIM 区间算法复杂 | 中 | 中 | 参考精确数实现 | 延迟到 v0.8 |
| 测试不充分 | 高 | 中 | TDD 方法,持续测试 | 增加测试时间 |
| 工期延迟 | 中 | 中 | 预留 20% 缓冲 | 拆分 v0.7.1 |

---

## 📝 交付物清单

### 代码交付

**新增文件**:
- `lib/algorithms/vikor_interval.py` (~200 行)
- `lib/algorithms/todim_interval.py` (~220 行)
- `lib/ranking/__init__.py`
- `lib/ranking/possibility_degree.py` (~150 行)
- `lib/utils/interval_utils.py` (~100 行)

**修改文件**:
- `lib/algorithms/__init__.py` (注册新算法)
- `lib/__init__.py` (导出新类)

**总代码量**: ~670 行实现代码

### 测试交付

**新增测试文件**:
- `tests/mcda-core/unit/test_algorithms/test_vikor_interval.py` (38 个测试)
- `tests/mcda-core/unit/test_algorithms/test_todim_interval.py` (28 个测试)
- `tests/mcda-core/unit/test_ranking/test_possibility_degree.py` (32 个测试)
- `tests/mcda-core/integration/test_v0.7_integration.py` (10 个测试)

**总测试量**: ~108 个测试, ~2000 行测试代码

### 文档交付

**新增文档**:
- `docs/plans/mcda-core/v0.7/execution-plan.md` (本文档)
- `docs/active/mcda-core/v0.7/` (进度追踪文件)

**更新文档**:
- `docs/decisions/mcda-core/007-interval-fuzzy-mcda-architecture.md` (已更新)
- `README_CN.md` (v0.7 功能说明)
- `CHANGELOG.md` (v0.7 发布说明)

---

## 🔗 相关文档

### 架构决策
- [ADR-007: 区间数/模糊数 MCDA 架构设计](../../decisions/mcda-core/007-interval-fuzzy-mcda-architecture.md)
- [ADR-009: v0.5 版本规划调整](../../decisions/mcda-core/009-v0.5-roadmap-adjustment.md)

### 版本规划
- [roadmap-complete.md](./roadmap-complete.md)
- [v0.5 checkpoint](../../checkpoints/mcda-core/checkpoint-v0.5-complete.md)
- [v0.6 checkpoint](../../checkpoints/mcda-core/checkpoint-v0.6-complete.md)

### 参考文档
- [VIKOR 算法说明](https://en.wikipedia.org/wiki/VIKOR_method)
- [TODIM 算法说明](https://www.sciencedirect.com/science/article/pii/S0377221703002610)
- [区间可能度排序](https://www.sciencedirect.com/science/article/pii/S036083521100218X)

---

## ✅ 验收标准

### 功能完整性
- [ ] VIKOR 区间版本实现并测试通过
- [ ] TODIM 区间版本实现并测试通过
- [ ] 可能度排序实现并集成
- [ ] 与现有算法兼容

### 质量指标
- [ ] 测试覆盖率 >= 85%
- [ ] 测试通过率 100% (108/108)
- [ ] 执行时间: VIKOR < 0.5s, TODIM < 0.5s
- [ ] 代码质量: 类型注解 100%, 文档字符串 100%

### 文档完整性
- [ ] API 文档完整
- [ ] 数学模型说明清晰
- [ ] 使用示例充分
- [ ] README 更新

### 性能指标
- [ ] 10 方案 × 10 准则 < 1 秒
- [ ] 50 方案 × 20 准则 < 5 秒
- [ ] 可能度排序: 10 个区间 < 0.1 秒

---

## 📞 联系与反馈

**项目维护者**: hunkwk + AI architect agent
**最后更新**: 2026-02-04
**下次审查**: Phase 0 完成后 (Day 2)

---

**状态**: 📋 规划完成，待批准
**下一步**: 开始 Phase 0 技术验证
