# CSV/Excel 导入功能详细设计

**版本**: v0.9
**创建日期**: 2026-02-05
**状态**: 📋 设计中

---

## 📋 设计概述

### 目标

实现 CSV 和 Excel 格式的决策数据导入功能，降低用户使用门槛。

### 设计原则

1. **用户友好**: 格式直观，易于编辑
2. **容错性强**: 优雅处理格式错误
3. **功能完整**: 支持所有现有功能（区间数、权重等）
4. **文档完善**: 提供模板和示例

---

## 📐 CSV 格式设计

### 格式约定

**文件扩展名**: `.csv`

**编码**: UTF-8（推荐）或 GBK

**分隔符**: 逗号（`,`）

### 文件结构

```
方案A,方案B,方案C
性能,0.4,higher,85,90,88
成本,0.3,lower,50,60,55
可靠性,0.2,higher,90,85,92
易用性,0.1,higher,80,75,78
```

### 结构说明

| 行 | 说明 | 列数 | 格式 |
|----|------|------|------|
| 第 1 行 | 备选方案名称 | N+1 | `备选1,备选2,...,备选N` |
| 第 2+ 行 | 准则数据 | 3+N | `准则名,权重,方向,得分1,...,得分N` |

### 区间数格式

支持两种格式：

1. **逗号分隔**: `70,90`
2. **方括号格式**: `[70,90]`

---

## 📐 Excel 格式设计

### Sheet1: 决策矩阵

#### 表格结构

```
┌─────────┬─────────┬─────────┬─────────┬─────────┐
│         │ 权重    │ 方向    │ 方案A   │ 方案B   │
├─────────┼─────────┼─────────┼─────────┼─────────┤
│ 性能    │ 0.4     │ higher  │ 85      │ 90      │
│ 成本    │ 0.3     │ lower   │ 50      │ 60      │
│ 可靠性  │ 0.2     │ higher  │ 90      │ 85      │
│ 易用性  │ 0.1     │ higher  │ 80      │ 75      │
└─────────┴─────────┴─────────┴─────────┴─────────┘
```

### Sheet2: 元信息（可选）

```
┌─────────────┬──────────────────┐
│ 问题名称    │ 供应商选择      │
│ 算法        │ topsis           │
│ 描述        │ ...              │
└─────────────┴──────────────────┘
```

---

## 🛠️ 技术实现要点

### CSVLoader 类

```python
class CSVLoader(ConfigLoader):
    """CSV 配置文件加载器"""

    # 方向别名映射
    DIRECTION_ALIASES = {
        'higher': 'higher',
        'h': 'higher',
        'lower': 'lower',
        'l': 'lower',
    }

    def load(self, source: Union[str, Path]) -> dict[str, Any]:
        """加载 CSV 配置文件"""
        # 实现逻辑...
```

### ExcelLoader 类

```python
class ExcelLoader(ConfigLoader):
    """Excel 配置文件加载器"""

    def load(self, source: Union[str, Path]) -> dict[str, Any]:
        """加载 Excel 配置文件"""
        try:
            import openpyxl
        except ImportError:
            raise ImportError(
                "请安装 openpyxl: pip install openpyxl"
            )
        # 实现逻辑...
```

---

## 📊 验收标准

### 功能验收
- [ ] 可以从 CSV 加载决策问题
- [ ] 可以从 Excel 加载决策问题
- [ ] 支持区间数格式（"a,b" 或 "[a,b]"）
- [ ] 格式错误时提供清晰的错误信息

### 质量验收
- [ ] 单元测试覆盖率 ≥ 85%
- [ ] 集成测试通过
- [ ] 代码规范符合 PEP 8

---

**设计状态**: 📋 完成
**下一步**: 开始实现
