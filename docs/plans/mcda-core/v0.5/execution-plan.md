# MCDA Core v0.5 执行计划

**创建日期**: 2026-02-03
**状态**: ✅ 已批准
**预计工期**: 19 人日 (4 周)
**Git 分支**: feature/mcda-core

---

## 1. 需求重述

### 1.1 核心需求

根据 ADR-009 和 roadmap-complete.md，v0.5 包含以下功能：

| 优先级 | 功能 | 工期 | 说明 |
|--------|------|------|------|
| **P0** | **VIKOR 算法** | 3人日 | 折衷排序算法，补充核心缺失 |
| **P0** | **博弈论组合赋权** | 5人日 | 集成多种赋权方法 |
| **P1** | **区间数数据模型** | 2人日 | Interval 类型 |
| **P1** | **TOPSIS 区间版本** | 3人日 | 最常用区间算法 |

**总工期**: 13 人日(核心) + 3 人日(测试文档) + 3 人日(缓冲) = **19 人日**

### 1.2 验收标准

**功能完整性**:
- [ ] VIKOR 算法实现并测试通过
- [ ] 博弈论组合赋权工作正常
- [ ] 区间数数据模型完成
- [ ] TOPSIS 区间版本实现

**质量指标**:
- [ ] 测试覆盖率 >= 80%
- [ ] 所有测试通过
- [ ] 代码质量 >= 4 星
- [ ] 文档完整

**性能指标**:
- [ ] VIKOR 执行时间 < 0.5 秒
- [ ] 组合赋权执行时间 < 1 秒
- [ ] TOPSIS 区间版本执行时间 < 1 秒

---

## 2. 分阶段计划

### Phase 1: VIKOR 算法 (5 人日, 1 周)

**复杂度**: Medium

**数学模型**:
```
群体效用: S_i = Σ w_j · (x_j^max - x_ij) / (x_j^max - x_j^min)
个别遗憾: R_i = max_j [w_j · (x_j^max - x_ij) / (x_j^max - x_j^min)]
折衷值: Q_i = v · (S_i - S_min) / (S_max - S_min) + (1-v) · (R_i - R_min) / (R_max - R_min)
```

#### 实施步骤

**Day 1-2: RED - 编写测试**
- 基础功能测试 (8 个)
- 详细功能测试 (8 个)
- 边界条件测试 (6 个)
- 错误处理测试 (3 个)

**Day 3-4: GREEN - 实现功能**
- 实现 VIKOR.calculate() 基本逻辑
- 实现群体效用 S 计算
- 实现个别遗憾 R 计算
- 实现折衷值 Q 计算
- 实现折衷解判定逻辑

**Day 5: REFACTOR - 优化**
- 代码结构优化
- 性能优化
- 添加注释和文档
- 测试覆盖率 >= 85%

**验收标准**:
- [ ] 28 个测试全部通过
- [ ] 测试覆盖率 >= 85%
- [ ] 执行时间 < 0.5 秒

---

### Phase 2: 博弈论组合赋权 (5 人日, 1 周)

**复杂度**: High

**数学模型**:
```
最优组合权重: w* = W^T · W⁻¹ · R / (W^T · W⁻¹ · W)
```

#### 实施步骤

**Day 1: RED - 编写测试**
- 基础功能测试 (6 个)
- 数学正确性测试 (6 个)
- 边界条件测试 (4 个)
- 错误处理测试 (2 个)
- 集成测试 (2 个)

**Day 2-3: GREEN - 实现功能**
- 实现 GameTheoryWeighting 类
- 实现权重组合逻辑
- 实现线性方程组求解
- 添加输入验证

**Day 4: REFACTOR - 优化**
- 优化数值稳定性
- 添加正则化项
- 性能优化

**Day 5: 集成**
- YAML 配置支持
- 与现有赋权方法集成
- 文档和示例

**验收标准**:
- [ ] 20 个测试全部通过
- [ ] 测试覆盖率 >= 80%
- [ ] 执行时间 < 1 秒

---

### Phase 3: 区间数基础 (6 人日, 1.5 周)

**复杂度**: High

#### Phase 3.1: Interval 数据类型 (2 人日)

**实施步骤**:
- 定义 Interval 数据类
- 实现区间算术运算 (+, -, ×, ÷)
- 实现区间排序(中点法)
- 添加输入验证
- 12 个测试

**验收标准**:
- [ ] Interval 类型实现完成
- [ ] 所有算术运算测试通过
- [ ] 测试覆盖率 >= 90%

#### Phase 3.2: TOPSIS 区间版本 (3 人日)

**实施步骤**:
- 实现区间决策矩阵构建
- 实现 Vector 标准化(区间)
- 实现区间理想解确定
- 实现区间距离计算
- 实现相对贴近度计算
- 20 个测试

**验收标准**:
- [ ] TOPSIS 区间版本实现完成
- [ ] 与精确数 TOPSIS 结果一致(当区间退化为点)
- [ ] 测试覆盖率 >= 80%

#### Phase 3.3: 文档与验证 (1 人日)
- API 文档
- 使用示例
- 性能验证

---

### Phase 4: 集成测试与文档 (3 人日, 0.5 周)

**复杂度**: Low

#### 实施步骤

**Day 1: 集成测试**
- VIKOR + 组合赋权集成测试
- 区间 TOPSIS + 组合赋权集成测试
- 端到端 YAML 配置测试
- 多算法对比测试

**Day 2: 文档编写**
- API 文档更新
- 用户指南
- 示例代码
- CHANGELOG

**Day 3: 验证与发布**
- 性能验证
- 代码质量检查
- Git 提交
- 创建 Checkpoint

**验收标准**:
- [ ] 10 个集成测试全部通过
- [ ] 文档完整
- [ ] 所有性能指标达标

---

## 3. 依赖关系

```
Phase 1: VIKOR (无依赖)
    ↓
Phase 2: 博弈论组合赋权 (依赖现有赋权方法)
    ↓
Phase 3: 区间数基础
    ├── 3.1 Interval (无依赖)
    └── 3.2 TOPSIS 区间 (依赖 Interval, TOPSIS)
    ↓
Phase 4: 集成测试与文档 (依赖所有前置)
```

**关键路径**: Phase 2 → Phase 3.2 → Phase 4 (11 人日)

---

## 4. 测试计划

### 测试数量

| Phase | 功能 | 测试数 |
|-------|------|--------|
| Phase 1 | VIKOR | 28 |
| Phase 2 | 组合赋权 | 20 |
| Phase 3.1 | Interval | 12 |
| Phase 3.2 | TOPSIS 区间 | 20 |
| Phase 4 | 集成测试 | 10 |
| **总计** | | **90** |

**v0.5 总测试数**: 225 (v0.4: 135 + v0.5: 90)

### 测试分类

| 类别 | 比例 | 数量 |
|------|------|------|
| 基础功能 | 35% | 32 |
| 详细功能 | 30% | 27 |
| 边界条件 | 20% | 18 |
| 错误处理 | 10% | 9 |
| 集成测试 | 5% | 4 |

---

## 5. 风险与缓解

### 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| VIKOR 折衷解判定复杂 | 中 | 中 | 参考学术论文，简化判定条件 |
| 博弈论矩阵奇异 | 低 | 高 | 添加正则化项，降维处理 |
| 区间运算数值不稳定 | 中 | 中 | 使用 numpy 稳定版本，添加容差 |
| 区间 TOPSIS 理想解确定 | 中 | 中 | 使用中点法简化 |

### 进度风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| Phase 3 工作量低估 | 中 | 高 | 预留 3 人日缓冲 |
| 测试时间不足 | 低 | 中 | 提前编写测试，边开发边验证 |

---

## 6. 工具链

### 测试工具

```bash
# 运行测试
pytest tests/mcda-core/ -v

# 测试覆盖率
pytest tests/mcda-core/ --cov=mcda_core --cov-report=html

# 类型检查
mypy skills/mcda-core/lib/

# 代码格式化
ruff check skills/mcda-core/lib/
```

### 进度追踪

使用 `docs/active/mcda-core/v0.5/` 下的进度文件：
- `tdd-vikor.md` - Phase 1 进度
- `tdd-game-theory-weighting.md` - Phase 2 进度
- `tdd-interval.md` - Phase 3 进度
- `progress-summary.md` - 总体进度

---

## 7. 成功标准

### 代码质量
- 测试覆盖率 >= 80%
- 所有测试通过 (pytest)
- 代码通过 linting (ruff)
- 类型检查通过 (mypy)

### 功能完整性
- VIKOR 算法正常工作
- 博弈论组合赋权正常工作
- 区间数数据模型完成
- TOPSIS 区间版本正常工作

### 性能指标
- VIKOR 执行时间 < 0.5 秒
- 组合赋权执行时间 < 1 秒
- TOPSIS 区间版本执行时间 < 1 秒

---

## 8. 下一步

**立即行动**:
1. 创建进度追踪文件 `docs/active/mcda-core/v0.5/`
2. 开始 Phase 1: VIKOR 算法 TDD 开发
3. 使用 `/tdd` 命令启动测试驱动开发

**命令**:
```bash
# 开始 TDD 开发
/tdd

# 或创建进度文件
# docs/active/mcda-core/v0.5/tdd-vikor.md
```

---

**文档版本**: v1.0
**创建日期**: 2026-02-03
**状态**: ✅ 已批准
**预计完成**: 2026-03-03 (4 周)
