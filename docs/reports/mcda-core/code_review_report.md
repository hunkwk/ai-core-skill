# MCDA-Core æ·±å…¥ä»£ç å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-06  
**å®¡æŸ¥èŒƒå›´**: `skills/mcda-core` ç›®å½•ä¸‹çš„å…¨éƒ¨ä»£ç   
**å®¡æŸ¥äººå‘˜**: AI Code Reviewer

---

## æ‰§è¡Œæ‘˜è¦

ç»è¿‡æ·±å…¥å®¡æŸ¥ï¼Œå…±å‘ç° **21 ä¸ªé—®é¢˜**ï¼Œå…¶ä¸­ï¼š

| çº§åˆ« | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| ğŸ”´ **Critical** | 3 | éœ€è¦ç«‹å³ä¿®å¤ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡é”™è¯¯ |
| ğŸŸ  **High Risk** | 5 | é«˜é£é™©é—®é¢˜ï¼Œå½±å“ä»£ç è´¨é‡å’Œç»´æŠ¤æ€§ |
| ğŸŸ¡ **Medium** | 6 | ä¸­ç­‰é—®é¢˜ï¼Œå»ºè®®å°½å¿«ä¿®å¤ |
| ğŸŸ¢ **Low** | 7 | ä½ä¼˜å…ˆçº§é—®é¢˜ï¼Œå¯ä»¥é€æ­¥æ”¹è¿› |

---

## ä¸€ã€ä¸¥é‡é—®é¢˜ (Critical Issues)

### 1. å¾ªç¯å¯¼å…¥é£é™© âš ï¸

**ä½ç½®**: `lib/scoring/applier.py` ç¬¬ 9-13 è¡Œ

```python
import sys
from pathlib import Path
# æ·»åŠ çˆ¶ç›®å½•åˆ°è·¯å¾„ä»¥å¯¼å…¥ models
sys.path.insert(0, str(Path(__file__).parent.parent))
import models
```

**é—®é¢˜æè¿°**: 
- ä½¿ç”¨ `sys.path.insert` æ˜¯éå¸¸å±é™©çš„åšæ³•ï¼Œä¼šå¯¼è‡´ï¼š
  - å‘½åç©ºé—´æ±¡æŸ“
  - ä¸å…¶ä»–æ¨¡å—å†²çª
  - éš¾ä»¥è°ƒè¯•çš„å¯¼å…¥é”™è¯¯
  - ç ´å Python çš„åŒ…ç®¡ç†æœºåˆ¶

**å½±å“**: å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å¯¼å…¥é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯åœ¨é¡¹ç›®ç»“æ„å˜åŒ–æ—¶ã€‚

**ä¿®å¤å»ºè®®**:
```python
# æ”¹ä¸ºç›¸å¯¹å¯¼å…¥
from .. import models
# æˆ–è€…ç»å¯¹å¯¼å…¥
from mcda_core import models
```

---

### 2. Interval ç±»çš„æ¯”è¾ƒé€»è¾‘ç¼ºé™· âš ï¸

**ä½ç½®**: `lib/interval.py` ç¬¬ 193-206 è¡Œ

```python
def __eq__(self, other: object) -> bool:
    """åŸºäºä¸­ç‚¹æ¯”è¾ƒ"""
    if not isinstance(other, Interval):
        return NotImplemented
    return self.midpoint == other.midpoint  # é—®é¢˜ï¼šä¸åŒåŒºé—´å¯èƒ½æœ‰ç›¸åŒä¸­ç‚¹
```

**é—®é¢˜æè¿°**:
- `[1, 3]` å’Œ `[2, 2]` çš„ä¸­ç‚¹éƒ½æ˜¯ `2.0`ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„
- è¿™è¿åäº†æ•°å­¦ä¸ŠåŒºé—´ç›¸ç­‰çš„å®šä¹‰
- å¯èƒ½å¯¼è‡´æ’åºå’Œå»é‡é”™è¯¯

**ä¿®å¤å»ºè®®**:
```python
def __eq__(self, other: object) -> bool:
    """åŸºäºåŒºé—´ç«¯ç‚¹æ¯”è¾ƒ"""
    if not isinstance(other, Interval):
        return NotImplemented
    return self.lower == other.lower and self.upper == other.upper
```

---

### 3. CSV æ³¨å…¥é˜²æŠ¤è¿‡åº¦ä¸”æœ‰é—®é¢˜ âš ï¸

**ä½ç½®**: `lib/loaders/csv_loader.py` ç¬¬ 186-192 è¡Œ

```python
dangerous_chars = {'$', '=', '+', '-', '*', '/', '(', ')', '{', '}'}
if any(char in score_str for char in dangerous_chars):
    raise ValueError(...)
```

**é—®é¢˜æè¿°**:
- è¿å­—ç¬¦ `-` è¢«ç¦æ­¢ï¼Œä½†è´Ÿæ•°æ˜¯åˆæ³•çš„æ•°å€¼
- è¿™ä¼šå¯¼è‡´åˆæ³•çš„è´Ÿæ•°è¾“å…¥è¢«æ‹’ç»
- ä¾‹å¦‚ `-10` ä¼šè¢«é”™è¯¯åœ°æ‹’ç»

**ä¿®å¤å»ºè®®**:
```python
# ä»…åœ¨ç‰¹å®šä½ç½®æ£€æŸ¥ï¼Œæˆ–è€…ä½¿ç”¨æ›´å®‰å…¨çš„è§£ææ–¹å¼
# æ›´å¥½çš„åšæ³•æ˜¯å…ˆå°è¯•è§£æä¸ºæ•°å€¼ï¼Œå†æ£€æŸ¥
# æˆ–è€…ç§»é™¤ '-' ä»å±é™©å­—ç¬¦åˆ—è¡¨ï¼Œå› ä¸ºè´Ÿæ•°æ˜¯åˆæ³•çš„
```

---

## äºŒã€é«˜é£é™©é—®é¢˜ (High Risk Issues)

### 4. ä»£ç é‡å¤ä¸¥é‡ - ç®—æ³•åŸºç±»éªŒè¯é‡å¤ ğŸ”

**ä½ç½®**: å¤šä¸ªç®—æ³•æ–‡ä»¶

æ¯ä¸ªç®—æ³•ç±»éƒ½æœ‰å‡ ä¹ç›¸åŒçš„éªŒè¯ä»£ç ï¼š

```python
# topsis_interval.py ç¬¬ 98-102 è¡Œ
if n_alt < 2:
    raise ValueError("è‡³å°‘éœ€è¦ 2 ä¸ªå¤‡é€‰æ–¹æ¡ˆ")
if n_crit < 1:
    raise ValueError("è‡³å°‘éœ€è¦ 1 ä¸ªå‡†åˆ™")

# promethee2_interval.py ç¬¬ 136-140 è¡Œï¼ˆå®Œå…¨ç›¸åŒçš„ä»£ç ï¼‰
if n_alt < 2:
    raise ValueError("è‡³å°‘éœ€è¦ 2 ä¸ªå¤‡é€‰æ–¹æ¡ˆ")
if n_crit < 1:
    raise ValueError("è‡³å°‘éœ€è¦ 1 ä¸ªå‡†åˆ™")
```

**é—®é¢˜**: è¿å DRY åŸåˆ™ï¼Œç»´æŠ¤å›°éš¾ï¼Œä¿®æ”¹æ—¶éœ€è¦ä¿®æ”¹å¤šå¤„ã€‚

**ä¿®å¤å»ºè®®**: å°†éªŒè¯é€»è¾‘æå–åˆ°åŸºç±»æ–¹æ³•ä¸­ã€‚

---

### 5. æµ®ç‚¹æ•°æ¯”è¾ƒæ²¡æœ‰å®¹å·® ğŸ”¢

**ä½ç½®**: `lib/interval.py` ç¬¬ 52-55 è¡Œ

```python
def __post_init__(self):
    if self.lower > self.upper:  # åº”è¯¥ä½¿ç”¨å®¹å·®æ¯”è¾ƒ
        raise IntervalError(...)
```

**é—®é¢˜**: æµ®ç‚¹æ•°è®¡ç®—è¯¯å·®å¯èƒ½å¯¼è‡´ `lower` ç•¥å¤§äº `upper` æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚

**ä¿®å¤å»ºè®®**:
```python
def __post_init__(self):
    EPSILON = 1e-9
    if self.lower > self.upper + EPSILON:
        raise IntervalError(...)
```

---

### 6. æ ¸å¿ƒç¼–æ’å™¨ä»£ç é‡å¤ ğŸ”

**ä½ç½®**: `lib/core.py` ç¬¬ 59-196 è¡Œ

ä¸‰ä¸ªåŠ è½½æ–¹æ³•ï¼ˆ`load_from_yaml`, `load_from_json`, `load_from_file`ï¼‰æœ‰å®Œå…¨ç›¸åŒçš„è§£æé€»è¾‘é‡å¤äº†ä¸‰æ¬¡ã€‚

**é‡å¤ä»£ç **:
```python
alternatives = self._parse_alternatives(data)
criteria = self._parse_criteria(data, auto_normalize_weights)
scores = self._parse_scores(data, alternatives, criteria)
algorithm_config = self._parse_algorithm_config(data)
```

**ä¿®å¤å»ºè®®**: æå–å…¬å…±çš„ `_build_problem_from_data` æ–¹æ³•ã€‚

---

### 7. æœªä½¿ç”¨çš„å˜é‡ ğŸ—‘ï¸

**ä½ç½®**: `lib/core.py` ç¬¬ 581 è¡Œ

```python
score = float(alt_scores[crit_name])  # å®šä¹‰äº†ä½†æœªä½¿ç”¨
```

**é—®é¢˜**: è¿™è¡Œä»£ç åœ¨å¾ªç¯ä¸­å®šä¹‰äº† `score` ä½†æ²¡æœ‰ä½¿ç”¨ï¼Œæ˜¯é—ç•™ä»£ç ã€‚

---

### 8. ç±»å‹æ³¨è§£ä¸ä¸€è‡´ ğŸ“

**ä½ç½®**: `lib/core.py`

- ç¬¬ 59 è¡Œ: `file_path: Path | str`ï¼ˆæ–°è¯­æ³•ï¼‰
- ç¬¬ 110 è¡Œ: `file_path: Union[str, Path]`ï¼ˆæ—§è¯­æ³•ï¼‰

**é—®é¢˜**: åº”è¯¥ç»Ÿä¸€ä½¿ç”¨ `|` è¯­æ³•ï¼ˆPython 3.10+ï¼‰ã€‚

---

## ä¸‰ã€ä¸­ç­‰é—®é¢˜ (Medium Issues)

### 9. é­”æ³•æ•°å­— ğŸ”®

**ä½ç½®**: `lib/algorithms/topsis_interval.py` ç¬¬ 196-197 è¡Œ

```python
if norm < 1e-10:  # é­”æ³•æ•°å­—
    norm = 1.0
```

**ä¿®å¤å»ºè®®**: å®šä¹‰ä¸ºæ¨¡å—çº§å¸¸é‡ã€‚

---

### 10. ç¼ºå°‘ `__all__` å®šä¹‰ ğŸ“‹

**ä½ç½®**: `lib/validation.py`

æ²¡æœ‰å®šä¹‰ `__all__`ï¼Œå¯¼è‡´ `from validation import *` ä¼šå¯¼å…¥æ‰€æœ‰å†…å®¹ã€‚

---

### 11. æ·±æ‹·è´æ€§èƒ½é—®é¢˜ ğŸŒ

**ä½ç½®**: `lib/services/constraint_service.py` ç¬¬ 90 è¡Œ

```python
adjusted_problem = deepcopy(problem)  # æ·±æ‹·è´æ•´ä¸ªå¯¹è±¡
```

ä½†ç´§æ¥ç€ç¬¬ 112-120 è¡Œåˆé‡æ–°åˆ›å»ºäº†å¯¹è±¡ï¼Œæ·±æ‹·è´è¢«æµªè´¹äº†ã€‚

---

### 12. å¼‚å¸¸å¤„ç†ä¸ä¸€è‡´ âš ï¸

**ä½ç½®**: `lib/algorithms/base.py` ç¬¬ 107-132 è¡Œ

åŸºç±»ä½¿ç”¨ `ValueError`ï¼Œä½†å…¶ä»–æ¨¡å—ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸å¦‚ `MCDAValidationError`ã€‚

---

## å››ã€ä½ç­‰é—®é¢˜ (Low Issues)

### 13. æ–‡æ¡£å­—ç¬¦ä¸²ä¸­çš„æ‹¼å†™é”™è¯¯ âœï¸

**ä½ç½®**: `lib/algorithms/promethee2_interval.py` ç¬¬ 104 è¡Œ

```python
preference_function: åå·®å‡½æ•°ç±»å‹ï¼ˆåº”è¯¥æ˜¯"åå¥½å‡½æ•°"ï¼‰
```

---

### 14. å¯¼å…¥ä½ç½®ä¸ä¸€è‡´ ğŸ“¥

æœ‰äº›ç®—æ³•åœ¨æ¨¡å—é¡¶éƒ¨å¯¼å…¥ `numpy`ï¼Œæœ‰äº›åœ¨æ–¹æ³•å†…éƒ¨å¯¼å…¥ã€‚

---

### 15. æ’åå¤„ç†ä¸ä¸€è‡´ ğŸ“Š

ä¸åŒç®—æ³•æ„å»º `RankingItem` çš„æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œåº”è¯¥ç»Ÿä¸€ã€‚

---

## äº”ã€è®¾è®¡é—®é¢˜ (Design Issues)

### 16. Interval ç±»ç¼ºå°‘å®Œæ•´çš„æ•°å­¦è¿ç®—

å½“å‰åªå®ç°äº† `+`, `-`, `*`, `/`ï¼Œç¼ºå°‘ï¼š
- å¹‚è¿ç®— (`**`)
- ç»å¯¹å€¼
- ä¸å…¶ä»– Interval çš„æ¯”è¾ƒæ–¹æ³•

---

### 17. ç®—æ³•å‚æ•°éªŒè¯é‡å¤

æ¯ä¸ªç®—æ³•éƒ½åœ¨ `__init__` å’Œ `calculate` ä¸­é‡å¤éªŒè¯å‚æ•°ã€‚

**å»ºè®®**: ä½¿ç”¨è£…é¥°å™¨æˆ–åŸºç±»æ–¹æ³•ç»Ÿä¸€éªŒè¯ã€‚

---

### 18. è¯„åˆ†çŸ©é˜µæ„å»ºé‡å¤

æ¯ä¸ªåŒºé—´ç®—æ³•éƒ½æœ‰å‡ ä¹ç›¸åŒçš„ä»£ç æ„å»ºè¯„åˆ†çŸ©é˜µã€‚

---

## å…­ã€å®‰å…¨é—®é¢˜ (Security Issues)

### 19. YAML åŠ è½½ä½¿ç”¨ `safe_load` âœ… (å·²æ­£ç¡®å¤„ç†)

å¥½æ¶ˆæ¯ï¼š`lib/utils.py` ç¬¬ 42 è¡Œæ­£ç¡®ä½¿ç”¨äº† `yaml.safe_load`ï¼Œé¿å…äº†ä»£ç æ³¨å…¥é£é™©ã€‚

---

## ä¸ƒã€æ€§èƒ½é—®é¢˜ (Performance Issues)

### 20. NumPy æ•°ç»„ä½¿ç”¨ object dtype ğŸ¢

**ä½ç½®**: `lib/algorithms/topsis_interval.py` ç¬¬ 108 è¡Œ

```python
scores_matrix = np.zeros((n_alt, n_crit), dtype=object)
```

**é—®é¢˜**: ä½¿ç”¨ `dtype=object` ä¼šå¤±å» NumPy çš„å‘é‡åŒ–æ€§èƒ½ä¼˜åŠ¿ã€‚

---

### 21. å›¾è¡¨å†…å­˜æ³„æ¼é£é™© ğŸ’§

**ä½ç½®**: `lib/visualization/charts.py` ç¬¬ 618-620 è¡Œ

```python
def __del__(self):
    """ææ„å‡½æ•°ï¼Œç¡®ä¿æ‰€æœ‰å›¾è¡¨éƒ½è¢«å…³é—­"""
    self.clear_figures()
```

**é—®é¢˜**: Python çš„ `__del__` ä¸ä¿è¯åŠæ—¶è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚

---

## å…«ã€ä¿®å¤å»ºè®®æ±‡æ€»

### ç«‹å³ä¿®å¤ (Critical)
1. ä¿®å¤ `lib/scoring/applier.py` çš„ `sys.path.insert`
2. ä¿®å¤ `lib/interval.py` çš„ `__eq__` æ–¹æ³•
3. ä¿®å¤ `lib/loaders/csv_loader.py` çš„è´Ÿæ•°å¤„ç†é—®é¢˜

### çŸ­æœŸä¿®å¤ (High Priority)
1. é‡æ„ `lib/core.py` æ¶ˆé™¤é‡å¤ä»£ç 
2. ç»Ÿä¸€å¼‚å¸¸å¤„ç†
3. æ·»åŠ æµ®ç‚¹æ•°æ¯”è¾ƒçš„å®¹å·®å¤„ç†

### é•¿æœŸæ”¹è¿› (Medium/Low Priority)
1. æå–å…¬å…±çš„çŸ©é˜µæ„å»ºé€»è¾‘
2. ç»Ÿä¸€ç±»å‹æ³¨è§£é£æ ¼
3. æ·»åŠ  `__all__` å®šä¹‰
4. ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ

---

## é™„å½•ï¼šé—®é¢˜ç»Ÿè®¡

### æŒ‰æ–‡ä»¶ç»Ÿè®¡

| æ–‡ä»¶ | Critical | High | Medium | Low | æ€»è®¡ |
|------|----------|------|--------|-----|------|
| `lib/scoring/applier.py` | 1 | 0 | 0 | 0 | 1 |
| `lib/interval.py` | 1 | 1 | 0 | 0 | 2 |
| `lib/loaders/csv_loader.py` | 1 | 0 | 0 | 0 | 1 |
| `lib/core.py` | 0 | 3 | 0 | 0 | 3 |
| `lib/algorithms/*.py` | 0 | 1 | 2 | 3 | 6 |
| `lib/services/*.py` | 0 | 0 | 2 | 0 | 2 |
| `lib/validation.py` | 0 | 0 | 1 | 0 | 1 |
| `lib/visualization/*.py` | 0 | 0 | 0 | 2 | 2 |
| **æ€»è®¡** | **3** | **5** | **6** | **7** | **21** |

### æŒ‰ç±»åˆ«ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| ä»£ç é‡å¤ | 4 |
| é€»è¾‘é”™è¯¯ | 3 |
| ç±»å‹é—®é¢˜ | 2 |
| æ€§èƒ½é—®é¢˜ | 2 |
| å®‰å…¨é—®é¢˜ | 1 |
| å…¶ä»– | 9 |

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-02-06*
