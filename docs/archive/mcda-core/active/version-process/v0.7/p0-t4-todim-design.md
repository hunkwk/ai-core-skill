# Phase 0: P0-T4 TODIM 区间算法设计

**任务**: P0-T4 TODIM 区间算法设计
**完成日期**: 2026-02-04
**状态**: ✅ 完成
**工期**: 0.2 人日

---

## 📊 执行总结

### 目标
设计 TODIM 算法的区间版本，为 Phase 3 实施做准备

### 结果
✅ **设计完成** - 技术可行，算法明确

---

## 🎯 设计目标

将 TODIM（前景理论决策）算法扩展到区间数，保持与精确数版本的兼容性

**核心挑战**:
- 如何定义区间收益/损失?
- 如何应用前景理论价值函数?
- 如何计算区间优势度?
- 如何排序?

---

## 📐 数学模型设计

### 1. 经典 TODIM 回顾

**前景理论价值函数**:
```
v(x) = {
    x^α,                   if x ≥ 0  (收益)
    -θ · (-x)^β,           if x < 0  (损失)
}
```

**参数**:
- α, β: 风险态度参数 (通常 α = β = 0.88)
- θ: 损失厌恶系数 (通常 θ = 2.25)

**优势度函数**:
```
Φ_i(A_j) = Σ (w_j / w_ref) · v(d_ij)
```

其中:
- d_ij = x_ij - x_ref (方案 i 在准则 j 下与参考点的差距)
- w_ref = max(w_j) (最大权重)
- v(d_ij): 前景价值函数

**全局优势度**:
```
δ_i = Σ Φ_i(A_j)
```

**排序**: 按 δ_i 降序排列

### 2. 区间 TODIM 扩展设计

#### 2.1 区间收益/损失判断

**定义**:
对于区间 X_ij = [x^L, x^U] 和参考点 r_j，如何判断收益还是损失?

**方案**: 使用可能度排序

```
P(X_ij ≥ r_j) = {
    1,                    if x^L ≥ r_j
    0,                    if x^U ≤ r_j
    (x^U - r_j) / (x^U - x^L),  otherwise
}
```

**判断规则**:
- 如果 P(X_ij ≥ r_j) ≥ 0.5 → 区间收益
- 如果 P(X_ij ≥ r_j) < 0.5 → 区间损失
- 如果 P(X_ij ≥ r_j) = 0.5 → 区间包含参考点（中性）

**简化方案** (替代):
使用中点法:
- 收益: X_ij.midpoint ≥ r_j
- 损失: X_ij.midpoint < r_j

**推荐**: 先用中点法（简单），Phase 3 可选集成可能度法

#### 2.2 区间前景价值函数

**区间收益版本**:
```
V(d) = [d^α, d^α]  (其中 d ≥ 0)
```

如果 d = [d^L, d^U] 是区间收益:
```
V(d) = [ (d^L)^α, (d^U)^α ]
```

**区间损失版本**:
```
V(d) = [ -θ · (-d)^β, -θ · (-d)^β ]  (其中 d < 0)
```

如果 d = [d^L, d^U] 是区间损失:
```
V(d) = [ -θ · (-(d^L))^β, -θ · (-(d^U))^β ]
     = [ -θ · (-d^L)^β, -θ · (-d^U)^β ]
```

**注意**:
- 如果 d 包含 0（即收益和损失混合），需要分段处理
- 简化方案: 使用中点法统一处理

#### 2.3 区间优势度计算

**公式**:
```
Φ_i(A_j) = [Φ^L, Φ^U] = Σ (w_j / w_ref) · V(d_ij)
```

**实现**:
- 使用 Interval 类的算术运算（已实现）
- 数乘: k × [a, b] = [ka, kb]
- 加法: [a, b] + [c, d] = [a+c, b+d]

**结果**: Φ_i(A_j) 是一个区间

#### 2.4 全局优势度聚合

**方案 A: 中点法** (推荐)
```
δ_i = Σ Φ_i(A_j).midpoint
```

**方案 B: 可能度法** (Phase 3 可选)
```
δ_i = Σ P(Φ_i(A_j) ≥ 0)
```

或者更复杂的可能度聚合方法

**推荐**: 先实现方案 A（中点法），简单高效

#### 2.5 排序方法

**方案 A: 中点法** (Phase 3)
```
按 δ_i 降序排列
```

**方案 B: 可能度法** (Phase 3 可选)
```
使用 PossibilityDegree 类对 {δ_1, δ_2, ..., δ_n} 排序
```

**推荐**: 方案 A 简单，方案 B 更精确

---

## 🔧 算法伪代码

```
算法: IntervalTODIM

输入:
    - problem: 区间决策问题
    - alternatives: 方案列表
    - criteria: 准则列表（含权重和方向）
    - scores: 区间评分矩阵
    - 参数: α = 0.88, β = 0.88, θ = 2.25

步骤:
    1. 确定参考点
       - 收益准则: r_j = min_i x_ij
       - 成本准则: r_j = max_i x_ij

    2. 计算区间优势度
       FOR 每个方案 i:
         FOR 每个准则 j:
           a. 计算差距: d_ij = x_ij - r_j  (区间减法)

           b. 判断收益/损失:
              IF d_ij.midpoint ≥ 0 THEN
                 v_ij = 前景价值函数_收益(d_ij)
              ELSE
                 v_ij = 前景价值函数_损失(d_ij)

           c. 计算优势度:
              Φ_ij = (w_j / w_ref) · v_ij
         END FOR

         δ_i = Σ Φ_ij.midpoint  (全局优势度)
       END FOR

    3. 排序
       rankings = rank_by(δ_i, descending=True)

    4. 返回结果
       RETURN DecisionResult(rankings, raw_scores=δ_i)
```

---

## ✅ 设计验证

### 算法可行性

| 方面 | 评估 | 说明 |
|------|------|------|
| 数学模型明确性 | ✅ 高 | 基于经典 TODIM，扩展合理 |
| 技术实现难度 | 🟢 中低 | 基于现有 Interval 类 |
| 与现有架构兼容性 | ✅ 高 | 可复用 Interval 算术运算 |
| 性能预期 | ✅ 好 | O(m×n)，与精确数版本相同 |
| 学术支持 | ✅ 充足 | TODIM 区间版本有多篇论文 |

### 实现要点

**核心依赖**:
- ✅ Interval 类（已实现）
- ✅ 区间算术运算（已实现）
- ✅ 可能度排序（P0-T2 已实现）

**新增代码**:
- `IntervalTODIM` 类 (~200 行)
- 区间前景价值函数 (~50 行)
- 测试用例 (28 个)

**预估工期**: 4 人日

### 边界条件处理

**退化区间**:
- 当 X_ij = [x, x] (单点区间) 时，应退化为经典 TODIM
- 自动兼容（因为 Interval 类支持退化区间）

**参考点边界**:
- 当 x_ij = r_j 时，d_ij = 0
- v(0) = 0^α = 0

**负数区间**:
- 支持负数区间（如成本准则）
- 差距计算和前景价值函数正常工作

---

## 📊 与精确数版本对比

| 维度 | 经典 TODIM | 区间 TODIM | 兼容性 |
|------|-----------|-----------|--------|
| 输入 | 精确数 | 区间数 | ✅ |
| 参考点 | min/max | min/max | ✅ |
| 差距计算 | d = x - r | d = [x^L - r, x^U - r] | ✅ |
| 收益/损失判断 | d ≥ 0 | d.midpoint ≥ 0 | ✅ |
| 前景价值函数 | v(d) | v([d^L, d^U]) | ✅ |
| 优势度 | Φ_ij (精确数) | Φ_ij (区间) | ✅ |
| 全局优势度 | δ_i (精确数) | δ_i = Σ Φ_ij.midpoint | ✅ |
| 排序 | 按 δ_i | 按 δ_i (或可能度) | ✅ |

**兼容性**: ✅ **完全兼容**
- 当所有区间退化为单点时，区间 TODIM = 经典 TODIM

---

## 🎯 实施建议

### Phase 3 实施计划

**工期**: 4 人日

**任务分解**:

1. **IntervalTODIM 类实现** (1.0 人日)
   - 类结构设计
   - 继承 MCDAAlgorithm 基类
   - 注册为 "todim_interval"

2. **区间前景价值函数** (1.0 人日)
   - 收益版本实现
   - 损失版本实现
   - 边界条件处理

3. **区间优势度计算** (1.0 人日)
   - 参考点确定
   - 差距计算
   - 优势度聚合

4. **排序与测试** (1.0 人日)
   - 全局优势度计算
   - 排序逻辑
   - 测试用例 (28 个)

**验证标准**:
- [ ] 与精确数 TODIM 兼容
- [ ] 测试覆盖率 >= 85%
- [ ] 测试通过率 100%
- [ ] 执行时间 < 0.5 秒

### 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 前景价值函数复杂度 | 中 | 低 | 使用 Interval 类简化实现 |
| 区间收益/损失判断 | 低 | 低 | 使用中点法简单明确 |
| 性能问题 | 低 | 低 | O(m×n) 复杂度，与精确数相同 |
| 边界条件处理 | 中 | 低 | 参考精确数版本，充分测试 |

**总体风险**: 🟢 **低**

---

## 📁 交付物

### 设计文档

1. **数学模型**: 完整的区间 TODIM 数学公式
2. **算法伪代码**: 详细的算法步骤
3. **实现要点**: 关键技术点和注意事项
4. **边界条件**: 特殊情况处理方案
5. **兼容性分析**: 与精确数版本的对比

### 后续行动

- [ ] 在 Phase 3 实现此设计
- [ ] 编写详细实现文档
- [ ] 准备测试数据

---

## ✅ 设计结论

### 决策: 继续实施 Phase 3

✅ **建议在 v0.7 实现 TODIM 区间版本**

**理由**:
1. ✅ 设计明确，技术可行
2. ✅ 基于现有 Interval 类，实现难度低
3. ✅ 与精确数版本完全兼容
4. ✅ 学术支持充足
5. ✅ 用户需求明确（前景理论在区间数下有意义）
6. ✅ 工期合理（4 人日）
7. ✅ 风险可控

### 价值评估

**技术价值**: ⭐⭐⭐⭐⭐ (5/5)
- 完善区间 MCDA 算法库
- TODIM + 区间数 = 前景理论 + 不确定性 = 高价值组合

**用户价值**: ⭐⭐⭐⭐ (4/5)
- TODIM 在风险决策中应用广泛
- 区间版本扩展了应用场景

**实现成本**: ⭐⭐⭐⭐⭐ (5/5)
- 工期合理（4 人日）
- 风险可控
- 复用现有代码

**总体评分**: ⭐⭐⭐⭐⭐ (5/5) - **强烈推荐**

---

**完成者**: AI (Claude Sonnet 4.5)
**完成日期**: 2026-02-04
**下一步**: Phase 3 实施此设计（4 人日）
