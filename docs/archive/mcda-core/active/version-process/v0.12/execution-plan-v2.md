# MCDA Core v0.12 执行计划 - 精简版

**版本**: v0.12
**创建日期**: 2026-02-05
**状态**: 📋 计划中
**策略**: 小步快跑，分阶段交付

---

## 🎯 版本目标

**v0.12: 性能测试和基础优化**

专注于性能基准建立和关键优化，为后续功能打下坚实基础。

**关键原则**:
- ✅ 小步快跑（2-3 人日）
- ✅ 可分阶段交付
- ✅ Token 高效管理
- ✅ TDD 驱动开发

---

## 📋 任务分解

### Phase 1: 性能测试框架（1 人日）⭐

**目标**: 建立性能测试基础设施

#### 1.1 创建性能测试目录结构
```bash
tests/mcda-core/performance/
├── __init__.py
├── utils.py              # 性能测量工具
├── test_large_scale.py   # 大规模测试
└── fixtures/
    ├── small_10x5.yaml
    ├── medium_50x20.yaml
    └── large_100x50.yaml
```

#### 1.2 实现性能测量工具
**文件**: `tests/mcda-core/performance/utils.py`

**核心功能**:
- `measure_execution_time()` - 测量执行时间和内存
- `PerformanceCriteria` - 性能验收标准
- `generate_performance_report()` - 生成性能报告

**验收标准**:
- [ ] 工具函数实现完成
- [ ] 支持 3 个规模级别（小/中/大）
- [ ] 性能报告生成（Markdown 格式）

#### 1.3 大规模数据测试
**文件**: `tests/mcda-core/performance/test_large_scale.py`

**测试场景**:
- 小规模: 10 方案 × 5 准则（< 0.5s）
- 中规模: 50 方案 × 20 准则（< 2s）
- 大规模: 100 方案 × 50 准则（< 10s）

**验收标准**:
- [ ] 3 个规模测试通过
- [ ] 性能基准数据建立
- [ ] 基准报告生成

---

### Phase 2: 性能优化（1 人日）⭐

**目标**: 优化关键性能瓶颈

#### 2.1 瓶颈分析
**任务**:
- 运行性能测试，识别 Top 5 瓶颈
- 生成性能分析报告
- 确定优化优先级

**验收标准**:
- [ ] 性能分析报告完成
- [ ] Top 5 瓶颈明确
- [ ] 优化方案确定

#### 2.2 NumPy 优化（可选）
**文件**: `skills/mcda-core/lib/utils/array_ops.py`（新建）

**优化点**:
- 矩阵运算向量化
- 批量计算优化

**验收标准**:
- [ ] 向量化实现完成
- [ ] 性能提升 >= 20%
- [ ] 功能测试通过

#### 2.3 缓存机制（可选）
**文件**: `skills/mcda-core/lib/utils/cache.py`（新建）

**优化点**:
- 计算结果缓存
- 权重计算缓存

**验收标准**:
- [ ] 缓存装饰器实现
- [ ] 缓存命中率 >= 30%
- [ ] 无缓存一致性问题

---

### Phase 3: 报告图表扩展（1 人日，可选）

**目标**: 扩展基础图表类型

#### 3.1 新增图表类型
**文件**: `skills/mcda-core/lib/visualization/charts.py`（扩展）

**新增图表**:
1. 雷达图 - 多维度对比
2. 热力图 - 准则相关性
3. 散点图 - 方案分布

**验收标准**:
- [ ] 3 种新图表实现
- [ ] 单元测试通过
- [ ] 图表样式美观

#### 3.2 报告主题系统（可选）
**文件**: `skills/mcda-core/lib/reports/themes.py`（新建）

**预定义主题**:
- default（默认绿色）
- professional（专业蓝色）
- minimal（极简黑白）

**验收标准**:
- [ ] 3 种主题实现
- [ ] 主题切换功能
- [ ] HTML 报告集成

---

### Phase 4: 集成测试和文档（0.5 人日）

#### 4.1 集成测试
**文件**: `tests/mcda-core/integration/test_v012_integration.py`

**验收标准**:
- [ ] 端到端测试通过
- [ ] 性能集成测试通过

#### 4.2 文档更新
**文档清单**:
- `v0.12-release-notes.md` - 发布说明
- `v0.12-performance-report.md` - 性能报告

**验收标准**:
- [ ] 发布说明完整
- [ ] 性能报告清晰

---

## 📊 版本规划

### 最小版本 v0.12.0（2 人日）⭐ 推荐

**包含内容**:
- Phase 1: 性能测试框架
- Phase 2: 性能优化（瓶颈分析）
- Phase 4: 集成测试和文档

**交付物**:
- 性能测试框架
- 性能基准报告
- 瓶颈分析报告

### 标准版本 v0.12.1（3-4 人日）

**包含内容**:
- v0.12.0 所有内容
- Phase 2.2: NumPy 优化
- Phase 3.1: 新增图表类型

**交付物**:
- 性能优化（20%+ 提升）
- 3 种新图表类型

### 完整版本 v0.12.2（5-6 人日）

**包含内容**:
- v0.12.1 所有内容
- Phase 2.3: 缓存机制
- Phase 3.2: 报告主题系统

**交付物**:
- 完整性能优化方案
- 报告主题系统

---

## ⏱️ 时间表（最小版本）

### Day 1: 性能测试框架
- 上午: 搭建测试目录，实现工具函数
- 下午: 实现大规模数据测试
- 晚上: 生成性能基准报告

### Day 2: 性能优化和文档
- 上午: 瓶颈分析，确定优化方案
- 下午: 实施关键优化
- 晚上: 集成测试，更新文档

---

## 🔧 技术方案

### 核心技术栈
- **性能测试**: pytest + psutil + tracemalloc
- **优化工具**: NumPy（可选）, functools.lru_cache
- **图表**: matplotlib（已有）
- **报告**: Markdown（已有）

### 依赖管理
```txt
# 已有依赖（无需新增）
pytest>=7.4.0
psutil>=5.9.0
matplotlib>=3.8.0
numpy>=1.24.0
```

---

## 📝 Token 管理策略

### 执行原则
1. **分阶段执行**: 每 Phase 完成后创建 checkpoint
2. **独立进度文件**: 每个 Phase 独立的 TDD 进度文件
3. **精简代码示例**: 只保留关键代码片段
4. **避免重复读取**: 使用摘要而非完整计划

### 进度文件命名
```
docs/active/mcda-core/v0.12/
├── execution-plan.md          # 主计划（本文件）
├── phase1-performance.md      # Phase 1 进度
├── phase2-optimization.md     # Phase 2 进度
├── phase3-charts.md           # Phase 3 进度
└── phase4-integration.md      # Phase 4 进度
```

### Checkpoint 策略
- 每个 Phase 完成后创建 checkpoint
- 归档已完成的进度文件
- 保留主计划用于整体追踪

---

## 🎯 验收标准

### v0.12.0（最小版本）
- [ ] 性能测试框架建立
- [ ] 3 个规模测试通过
- [ ] 性能基准报告生成
- [ ] Top 5 瓶颈识别
- [ ] 集成测试通过

### v0.12.1（标准版本）
- [ ] v0.12.0 所有内容
- [ ] NumPy 优化实现
- [ ] 性能提升 >= 20%
- [ ] 3 种新图表类型

### v0.12.2（完整版本）
- [ ] v0.12.1 所有内容
- [ ] 缓存机制实现
- [ ] 3 种报告主题

---

## 💡 与原计划对比

| 维度 | 原计划 | 新计划 | 改进 |
|------|--------|--------|------|
| **文件大小** | 24K（831行） | ~8K（~250行） | ✅ 减少 70% |
| **工期** | 7-10 人日 | 2-3 人日（最小版本） | ✅ 更灵活 |
| **任务数** | 13 个子任务 | 8 个核心任务 | ✅ 更聚焦 |
| **Token 效率** | 低（大量代码示例） | 高（只保留关键内容） | ✅ 节省 token |
| **交付策略** | 一次性交付 | 分阶段交付 | ✅ 降低风险 |

---

## 🚀 执行建议

### 推荐路径: 最小版本优先

**理由**:
1. **降低风险**: 2 人日可完成，失败成本低
2. **快速反馈**: 尽早获得性能基准数据
3. **灵活调整**: 根据结果决定是否继续
4. **Token 高效**: 避免因计划变更导致的 token 浪费

### 执行流程
```
1. 用户确认本计划
   ↓
2. 创建 Phase 1 进度文件
   ↓
3. TDD 驱动开发（RED → GREEN → REFACTOR）
   ↓
4. Phase 1 完成 → checkpoint
   ↓
5. 创建 Phase 2 进度文件
   ↓
6. 继续或调整优先级
```

---

## 📊 风险管理

### 高风险项

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 性能优化引入 Bug | 高 | 完整回归测试 |
| 工期超出预期 | 中 | 按 v0.12.0/12.1/12.2 分批交付 |
| Token 不足 | 低 | 分阶段执行，及时归档 |

### 应急计划

**场景 1: Day 1 进度落后**
- 策略: 优先完成性能测试框架，优化延期到 v0.12.1

**场景 2: 性能优化效果不明显**
- 策略: 发布 v0.12.0（带基准报告），优化延后

**场景 3: Token 快速消耗**
- 策略: 立即创建 checkpoint，归档进度文件

---

## 🎓 成功标准

### v0.12.0 发布标准
- ✅ 性能测试框架可用
- ✅ 基准数据建立
- ✅ 测试通过率 >= 95%
- ✅ 文档完整

### 下一版本规划
根据 v0.12.0 的结果决定：
- 如果性能问题严重 → v0.13 深度优化
- 如果性能可接受 → v0.13 图表增强
- 如果需要新功能 → v0.13 功能开发

---

**计划版本**: v2（精简版）
**创建日期**: 2026-02-05
**状态**: ✅ 待用户确认

---

## 总结

**v0.12 核心目标**: 建立性能基准，优化关键瓶颈

**推荐执行**: v0.12.0（2 人日）→ 评估 → v0.12.1/v0.12.2

**关键优势**:
- ✅ 范围可控（2-3 人日）
- ✅ Token 高效（文件减少 70%）
- ✅ 风险降低（分阶段交付）
- ✅ 灵活调整（根据结果决定下一步）
